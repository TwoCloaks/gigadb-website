#!/bin/bash

# Generated by chef. Don't ****ing touch!
# - unless you're editing the template (db_backup.erb) -

directory_name="<%= node[:gigadb][:db][:backup_folder] %>"

if [ -d $directory_name ]
then
    echo "Directory already exists"
else
   sudo mkdir -p $directory_name
   chown -R centos:gigadb-admin $directory_name
fi

filename=$directory_name$(date +%Y%m%d)".backup"

PGPASSWORD="<%= node[:gigadb][:db][:password] %>" pg_dump -h localhost -p 5432 -U <%= node[:gigadb][:db][:user] %> -Fc <%= node[:gigadb][:db][:database] %> -f $filename